<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFTR Precision Intelligence</title>
    
    <!-- Production CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Clinical Design -->
    <style>
        :root {
            --primary-blue: #1e40af;
            --primary-red: #dc2626;
            --primary-green: #059669;
            --primary-amber: #d97706;
            --primary-purple: #7c3aed;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-light: #e5e7eb;
            --bg-light: #f9fafb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .clinical-card {
            background: white;
            border-radius: 16px;
            border: 1px solid var(--border-light);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }

        .clinical-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .badge-clinical {
            padding: 0.375rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            border: 1px solid;
        }

        .badge-class-i {
            background: rgba(220, 38, 38, 0.1);
            color: #b91c1c;
            border-color: rgba(220, 38, 38, 0.2);
        }

        .badge-exceptional {
            background: rgba(217, 119, 6, 0.1);
            color: #b45309;
            border-color: rgba(217, 119, 6, 0.2);
        }

        .badge-responsive {
            background: rgba(5, 150, 105, 0.1);
            color: #047857;
            border-color: rgba(5, 150, 105, 0.2);
        }

        .badge-non-responsive {
            background: rgba(220, 38, 38, 0.1);
            color: #b91c1c;
            border-color: rgba(220, 38, 38, 0.2);
        }

        .search-input {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 1rem 1rem 1rem 3rem;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .search-input:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
            outline: none;
        }

        .variant-cell {
            padding: 1.25rem;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.2s;
        }

        .variant-cell:hover {
            background: #f8fafc;
        }

        .variant-cell.selected {
            background: #eff6ff;
            border-left: 4px solid var(--primary-blue);
        }

        .data-point {
            background: #f8fafc;
            padding: 1.25rem;
            border-radius: 12px;
            border: 1px solid var(--border-light);
        }

        .data-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .data-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        }

        .alert-critical {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-left: 4px solid #dc2626;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #d97706;
        }

        .alert-info {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-left: 4px solid #3b82f6;
        }

        .alert-success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-left: 4px solid #10b981;
        }

        .pill-button {
            padding: 0.625rem 1.25rem;
            border-radius: 9999px;
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pill-button-primary {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .pill-button-primary:hover {
            background: #1e3a8a;
            transform: translateY(-1px);
        }

        .pill-button-outline {
            background: transparent;
            color: var(--text-secondary);
            border-color: var(--border-light);
        }

        .pill-button-outline:hover {
            border-color: var(--primary-blue);
            color: var(--primary-blue);
            background: rgba(30, 64, 175, 0.05);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        .empty-state {
            padding: 4rem 2rem;
            text-align: center;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            opacity: 0.5;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="glass-panel sticky top-0 z-50 border-b">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-blue-100 rounded-lg">
                        <i class="fas fa-dna text-blue-600"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">CFTR Precision Intelligence</h1>
                        <p class="text-sm text-gray-600">Clinical Decision Support System</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-3">
                    <button onclick="toggleDataPanel()" class="pill-button pill-button-outline">
                        <i class="fas fa-database"></i>
                        <span class="hidden md:inline">Database</span>
                    </button>
                    <button onclick="showImportModal()" class="pill-button pill-button-primary">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span class="hidden md:inline">Import Data</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Left Panel - Variant List -->
            <div class="lg:col-span-1">
                <div class="clinical-card mb-6">
                    <div class="p-6 border-b">
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input 
                                type="text" 
                                id="searchInput"
                                class="search-input w-full"
                                placeholder="Search variants..."
                                onkeyup="searchVariants()"
                            >
                        </div>
                        
                        <div class="flex space-x-2 mt-4">
                            <button onclick="filterVariants('all')" class="pill-button pill-button-outline flex-1 text-sm">
                                All
                            </button>
                            <button onclick="filterVariants('exceptional')" class="pill-button pill-button-outline flex-1 text-sm">
                                <i class="fas fa-bolt text-amber-500"></i>
                                Exceptional
                            </button>
                            <button onclick="filterVariants('responsive')" class="pill-button pill-button-outline flex-1 text-sm">
                                <i class="fas fa-check text-green-500"></i>
                                Responsive
                            </button>
                        </div>
                    </div>

                    <div id="variantList" class="max-h-[calc(100vh-300px)] overflow-y-auto">
                        <!-- Variants load here -->
                        <div class="empty-state">
                            <i class="fas fa-spinner fa-spin empty-state-icon"></i>
                            <p>Loading variants...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Variant Detail -->
            <div class="lg:col-span-3">
                <!-- Variant Header -->
                <div id="variantHeader" class="clinical-card mb-6 p-8 hidden animate-fade-in">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                        <div>
                            <div class="flex items-center gap-3 mb-3">
                                <h2 id="variantName" class="text-3xl font-bold">Select a variant</h2>
                                <span id="sourceBadge" class="badge-clinical bg-blue-100 text-blue-700 border-blue-200 hidden">
                                    <i class="fas fa-upload"></i>
                                    Uploaded
                                </span>
                            </div>
                            <div id="variantBadges" class="flex flex-wrap gap-2">
                                <!-- Badges load here -->
                            </div>
                        </div>
                        
                        <div class="mt-4 md:mt-0 text-center md:text-right">
                            <div class="text-sm text-gray-500 mb-1">Classification</div>
                            <div id="variantClass" class="text-4xl font-bold text-gray-800">-</div>
                            <div id="variantSubtype" class="text-gray-600">Select a variant</div>
                        </div>
                    </div>
                </div>

                <!-- Variant Content -->
                <div id="variantContent" class="hidden animate-fade-in">
                    <!-- Nomenclature -->
                    <div class="clinical-card mb-6 p-6">
                        <h3 class="font-semibold text-gray-700 mb-4 flex items-center">
                            <i class="fas fa-tag mr-2 text-blue-500"></i>
                            Nomenclature
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="nomenclatureGrid">
                            <!-- Filled dynamically -->
                        </div>
                    </div>

                    <!-- Clinical Decision -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <div class="clinical-card p-6">
                            <h3 class="font-semibold text-gray-700 mb-4 flex items-center">
                                <i class="fas fa-stethoscope mr-2 text-red-500"></i>
                                Clinical Impact
                            </h3>
                            <div id="clinicalImpact" class="space-y-4">
                                <!-- Filled dynamically -->
                            </div>
                        </div>

                        <div class="clinical-card p-6">
                            <h3 class="font-semibold text-gray-700 mb-4 flex items-center">
                                <i class="fas fa-prescription-bottle-alt mr-2 text-green-500"></i>
                                Therapeutic Prediction
                            </h3>
                            <div id="therapeuticPrediction" class="space-y-4">
                                <!-- Filled dynamically -->
                            </div>
                        </div>

                        <div class="clinical-card p-6">
                            <h3 class="font-semibold text-gray-700 mb-4 flex items-center">
                                <i class="fas fa-chart-line mr-2 text-purple-500"></i>
                                Evidence Quality
                            </h3>
                            <div id="evidenceQuality" class="space-y-4">
                                <!-- Filled dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Clinical Alert -->
                    <div id="clinicalAlertPanel" class="clinical-card p-6 mb-6 hidden">
                        <div id="alertContent" class="flex items-start">
                            <!-- Alert loads here -->
                        </div>
                    </div>

                    <!-- Evidence Chain -->
                    <div class="clinical-card p-6">
                        <h3 class="font-semibold text-gray-700 mb-4 flex items-center">
                            <i class="fas fa-microscope mr-2 text-gray-500"></i>
                            Evidence Sources
                        </h3>
                        <div id="evidenceChain" class="text-sm">
                            <!-- Evidence loads here -->
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="clinical-card p-12 text-center">
                    <i class="fas fa-search text-gray-300 text-5xl mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">No Variant Selected</h3>
                    <p class="text-gray-500">Select a variant from the list to view clinical details</p>
                    <div class="mt-6">
                        <button onclick="searchVariant('G542X')" class="pill-button pill-button-outline mr-3">
                            Try G542X
                        </button>
                        <button onclick="searchVariant('F508del')" class="pill-button pill-button-outline">
                            Try F508del
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Import Modal -->
    <div id="importModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-white rounded-xl w-full max-w-md">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold">Import Data</h3>
                        <button onclick="closeImportModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <textarea id="jsonInput" 
                              class="w-full h-48 font-mono text-sm p-4 border rounded-lg mb-4"
                              placeholder='Paste JSON data...'></textarea>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeImportModal()" class="pill-button pill-button-outline">
                            Cancel
                        </button>
                        <button onclick="importJSON()" class="pill-button pill-button-primary">
                            <i class="fas fa-upload mr-2"></i>
                            Import
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Database Stats Panel -->
    <div id="dataPanel" class="fixed right-0 top-0 h-full w-80 bg-white shadow-xl z-40 transform translate-x-full transition-transform">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-semibold">Database Analytics</h3>
                <button onclick="toggleDataPanel()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="databaseStats">
                <!-- Stats load here -->
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Configuration
        const CONFIG = {
            SUPABASE_URL: 'https://oxlkisjwfarseyqgeyuw.supabase.co',
            SUPABASE_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im94bGtpc2p3ZmFyc2V5cWdleXV3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NjU2MzgsImV4cCI6MjA4NjI0MTYzOH0.O3RSGW2eMF_M_kywWsjXK9DM0saxvtu9aQUu8-YPkdU'
        };

        // State
        let STATE = {
            variants: [],
            filteredVariants: [],
            selectedVariant: null,
            activeFilter: 'all'
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadVariants();
            setupSearch();
        });

        // Load Variants
        async function loadVariants() {
            try {
                const response = await fetch(`${CONFIG.SUPABASE_URL}/rest/v1/clinician_view?select=*&order=legacy_name`, {
                    headers: {
                        'apikey': CONFIG.SUPABASE_KEY,
                        'Authorization': `Bearer ${CONFIG.SUPABASE_KEY}`
                    }
                });
                
                STATE.variants = await response.json();
                STATE.filteredVariants = [...STATE.variants];
                renderVariantList();
                
            } catch (error) {
                console.error('Load error:', error);
                showError('Failed to load variants');
            }
        }

        // Render Variant List
        function renderVariantList() {
            const list = document.getElementById('variantList');
            
            if (STATE.filteredVariants.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search empty-state-icon"></i>
                        <p>No variants found</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = STATE.filteredVariants.map(variant => {
                const isSelected = STATE.selectedVariant?.id === variant.id;
                const isExceptional = variant.class_subtype === 'exceptional';
                const isResponsive = variant.eti_prediction === 'responsive';
                
                return `
                    <div class="variant-cell ${isSelected ? 'selected' : ''}" 
                         onclick="selectVariant('${variant.legacy_name}')">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-semibold">${variant.legacy_name}</h4>
                            ${variant.cftr_class ? `
                                <span class="badge-clinical ${isExceptional ? 'badge-exceptional' : 'badge-class-i'}">
                                    Class ${variant.cftr_class}
                                </span>
                            ` : ''}
                        </div>
                        
                        ${variant.protein_name ? `
                            <div class="text-sm text-gray-600 mb-1">${variant.protein_name}</div>
                        ` : ''}
                        
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>${variant.final_determination || 'Unknown'}</span>
                            ${variant.eti_prediction ? `
                                <span class="${isResponsive ? 'text-green-600' : 'text-red-600'}">
                                    ETI ${variant.eti_prediction}
                                </span>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Select Variant
        function selectVariant(variantName) {
            const variant = STATE.variants.find(v => v.legacy_name === variantName);
            if (!variant) return;
            
            STATE.selectedVariant = variant;
            renderVariantDetail(variant);
            renderVariantList(); // Update selection
        }

        // Render Variant Detail
        function renderVariantDetail(variant) {
            // Show content, hide empty state
            document.getElementById('variantHeader').classList.remove('hidden');
            document.getElementById('variantContent').classList.remove('hidden');
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('clinicalAlertPanel').classList.add('hidden');
            
            const isExceptional = variant.class_subtype === 'exceptional';
            const isTrueClassI = variant.class_subtype === 'true';
            const isResponsive = variant.eti_prediction === 'responsive';
            
            // Header
            document.getElementById('variantName').textContent = variant.legacy_name;
            document.getElementById('variantClass').textContent = variant.cftr_class || '-';
            document.getElementById('variantClass').className = `text-4xl font-bold ${
                isExceptional ? 'text-amber-600' : 
                isTrueClassI ? 'text-red-600' : 
                variant.cftr_class ? 'text-blue-600' : 'text-gray-600'
            }`;
            document.getElementById('variantSubtype').textContent = 
                variant.class_subtype || (variant.cftr_class ? 'Standard' : 'Unknown');
            
            // Badges
            const badges = [];
            if (variant.cftr_class) {
                badges.push(`<span class="badge-clinical ${isExceptional ? 'badge-exceptional' : 'badge-class-i'}">
                    <i class="fas ${isExceptional ? 'fa-bolt' : 'fa-dna'}"></i>
                    Class ${variant.cftr_class}
                </span>`);
            }
            
            if (variant.final_determination === 'CF-causing') {
                badges.push(`<span class="badge-clinical badge-non-responsive">
                    <i class="fas fa-exclamation-triangle"></i>
                    CF-causing
                </span>`);
            }
            
            if (variant.eti_prediction) {
                badges.push(`<span class="badge-clinical ${isResponsive ? 'badge-responsive' : 'badge-non-responsive'}">
                    <i class="fas ${isResponsive ? 'fa-check' : 'fa-times'}"></i>
                    ETI ${variant.eti_prediction}
                </span>`);
            }
            
            document.getElementById('variantBadges').innerHTML = badges.join('');
            
            // Nomenclature
            const nomenclature = [];
            if (variant.protein_name) {
                nomenclature.push(`
                    <div class="data-point">
                        <div class="data-label">Protein Notation</div>
                        <div class="data-value">${variant.protein_name}</div>
                    </div>
                `);
            }
            
            if (variant.cdna_name) {
                nomenclature.push(`
                    <div class="data-point">
                        <div class="data-label">cDNA Notation</div>
                        <div class="data-value">${variant.cdna_name}</div>
                    </div>
                `);
            }
            
            if (variant.alt_names && variant.alt_names !== 'NA') {
                nomenclature.push(`
                    <div class="data-point">
                        <div class="data-label">Alternative Names</div>
                        <div class="data-value">${variant.alt_names}</div>
                    </div>
                `);
            }
            
            document.getElementById('nomenclatureGrid').innerHTML = nomenclature.join('');
            
            // Clinical Impact
            document.getElementById('clinicalImpact').innerHTML = `
                <div class="data-point">
                    <div class="data-label">Clinical Impact</div>
                    <div class="data-value ${variant.final_determination === 'CF-causing' ? 'text-red-600' : 'text-amber-600'}">
                        ${variant.final_determination || 'Unknown'}
                    </div>
                </div>
                <div class="data-point">
                    <div class="data-label">Classification</div>
                    <div class="data-value">${variant.cftr_class ? `Class ${variant.cftr_class}` : 'Unknown'}</div>
                </div>
                ${variant.class_subtype ? `
                    <div class="data-point">
                        <div class="data-label">Subtype</div>
                        <div class="data-value ${isExceptional ? 'text-amber-600' : 'text-red-600'}">
                            ${variant.class_subtype}
                        </div>
                    </div>
                ` : ''}
            `;
            
            // Therapeutic Prediction
            document.getElementById('therapeuticPrediction').innerHTML = `
                ${variant.eti_prediction ? `
                    <div class="data-point">
                        <div class="data-label">ETI Response</div>
                        <div class="data-value ${isResponsive ? 'text-green-600' : 'text-red-600'}">
                            ${variant.eti_prediction}
                        </div>
                    </div>
                ` : ''}
                ${variant.class_confidence ? `
                    <div class="data-point">
                        <div class="data-label">Confidence</div>
                        <div class="data-value capitalize">${variant.class_confidence}</div>
                    </div>
                ` : ''}
                ${variant.therapy_responsive !== null ? `
                    <div class="data-point">
                        <div class="data-label">Therapy Ready</div>
                        <div class="data-value ${variant.therapy_responsive ? 'text-green-600' : 'text-red-600'}">
                            ${variant.therapy_responsive ? 'Yes' : 'No'}
                        </div>
                    </div>
                ` : ''}
            `;
            
            // Evidence Quality
            document.getElementById('evidenceQuality').innerHTML = `
                ${variant.eti_evidence_level ? `
                    <div class="data-point">
                        <div class="data-label">Evidence Level</div>
                        <div class="data-value capitalize">${variant.eti_evidence_level.replace('_', ' ')}</div>
                    </div>
                ` : ''}
                ${variant.last_evidence_update ? `
                    <div class="data-point">
                        <div class="data-label">Last Update</div>
                        <div class="data-value">${new Date(variant.last_evidence_update).toLocaleDateString()}</div>
                    </div>
                ` : ''}
                <div class="data-point">
                    <div class="data-label">Evidence Sources</div>
                    <div class="data-value">
                        ${variant.evidence_count || 0}
                    </div>
                </div>
            `;
            
            // Clinical Alert
            if (variant.clinical_alert && !variant.clinical_alert.includes('Standard')) {
                const alertClass = isExceptional ? 'alert-warning' : 
                                 isTrueClassI ? 'alert-critical' : 'alert-info';
                
                document.getElementById('clinicalAlertPanel').classList.remove('hidden');
                document.getElementById('alertContent').innerHTML = `
                    <i class="fas ${isExceptional ? 'fa-bolt' : 'fa-exclamation-triangle'} mt-1 mr-3 
                       ${isExceptional ? 'text-amber-500' : 'text-red-500'}"></i>
                    <div>
                        <div class="font-semibold mb-1">Clinical Alert</div>
                        <div class="text-gray-700">${variant.clinical_alert}</div>
                        ${variant.eti_recommendation ? `
                            <div class="mt-3 text-sm text-gray-600">
                                <i class="fas fa-lightbulb mr-2"></i>
                                ${variant.eti_recommendation}
                            </div>
                        ` : ''}
                    </div>
                `;
                document.getElementById('clinicalAlertPanel').className = `clinical-card p-6 mb-6 ${alertClass}`;
            }
            
            // Evidence Chain
            if (variant.source_summary) {
                document.getElementById('evidenceChain').innerHTML = `
                    <div class="font-mono text-gray-600">
                        ${variant.source_summary.split('_').join(' â†’ ')}
                    </div>
                `;
            }
        }

        // Search and Filter
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            let timeout;
            
            searchInput.addEventListener('input', () => {
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    searchVariants();
                }, 300);
            });
        }

        function searchVariants() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            
            STATE.filteredVariants = STATE.variants.filter(v => 
                v.legacy_name.toLowerCase().includes(query) ||
                (v.protein_name && v.protein_name.toLowerCase().includes(query)) ||
                (v.cdna_name && v.cdna_name.toLowerCase().includes(query))
            );
            
            renderVariantList();
        }

        function filterVariants(filter) {
            STATE.activeFilter = filter;
            
            switch(filter) {
                case 'exceptional':
                    STATE.filteredVariants = STATE.variants.filter(v => v.class_subtype === 'exceptional');
                    break;
                case 'responsive':
                    STATE.filteredVariants = STATE.variants.filter(v => v.eti_prediction === 'responsive');
                    break;
                default:
                    STATE.filteredVariants = [...STATE.variants];
            }
            
            renderVariantList();
        }

        // Quick Search
        function searchVariant(name) {
            document.getElementById('searchInput').value = name;
            searchVariants();
            
            // Select if found
            setTimeout(() => {
                const variant = STATE.variants.find(v => v.legacy_name === name);
                if (variant) selectVariant(name);
            }, 100);
        }

        // Modal Functions
        function showImportModal() {
            document.getElementById('importModal').classList.remove('hidden');
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.add('hidden');
        }

        function toggleDataPanel() {
            const panel = document.getElementById('dataPanel');
            panel.classList.toggle('translate-x-full');
        }

        // Import
        async function importJSON() {
            const jsonInput = document.getElementById('jsonInput').value;
            
            try {
                const data = JSON.parse(jsonInput);
                showNotification('Data validated successfully', 'success');
                closeImportModal();
            } catch (error) {
                showNotification('Invalid JSON format', 'error');
            }
        }

        // Utility Functions
        function showNotification(message, type = 'info') {
            // Simple alert for now
            alert(`${type.toUpperCase()}: ${message}`);
        }

        function showError(message) {
            showNotification(message, 'error');
        }

        // Expose functions to window
        window.searchVariant = searchVariant;
        window.selectVariant = selectVariant;
        window.filterVariants = filterVariants;
        window.searchVariants = searchVariants;
        window.showImportModal = showImportModal;
        window.closeImportModal = closeImportModal;
        window.toggleDataPanel = toggleDataPanel;
        window.importJSON = importJSON;
    </script>
</body>
</html>
